var ScaleRectByScreenWidth=pc.createScript("scaleRectByScreenWidth");ScaleRectByScreenWidth.attributes.add("scaleFactor",{type:"number",default:1,title:"Scale Factor",description:"Коэффициент масштабирования (от 0 до 1)"}),ScaleRectByScreenWidth.attributes.add("refResolution",{type:"vec2",default:[1920,1080],title:"Reference Resolution",description:"Базовое разрешение экрана"}),ScaleRectByScreenWidth.attributes.add("targetRects",{type:"entity",array:!0,title:"Target Rects",description:"Список целевых объектов для масштабирования"}),ScaleRectByScreenWidth.prototype.initialize=function(){this.initScales=[];for(var t=0;t<this.targetRects.length;t++){var e=this.targetRects[t];e&&(this.initScales[t]=e.getLocalScale().clone())}this.lastWidth=this.app.graphicsDevice.width,this.lastHeight=this.app.graphicsDevice.height,this.updateScale()},ScaleRectByScreenWidth.prototype.update=function(){var t=this.app.graphicsDevice.width,e=this.app.graphicsDevice.height;t===this.lastWidth&&e===this.lastHeight||(this.lastWidth=t,this.lastHeight=e,this.updateScale())},ScaleRectByScreenWidth.prototype.updateScale=function(){var t=this.app.graphicsDevice.width,e=this.app.graphicsDevice.height;if(0!==t&&0!==e){var i=this.refResolution.x/this.refResolution.y,a=t/e;if(a<i)for(var c=pc.math.lerp(1,a/i,this.scaleFactor),s=0;s<this.targetRects.length;s++){if(r=this.targetRects[s]){var h=this.initScales[s];r.setLocalScale(h.x*c,h.y*c,h.z)}}else for(s=0;s<this.targetRects.length;s++){var r;if(r=this.targetRects[s]){h=this.initScales[s];r.setLocalScale(h.x,h.y,h.z)}}}else this.app.once("postupdate",this.updateScale,this)};var SnakeHead=pc.createScript("snakeHead");SnakeHead.attributes.add("gridSize",{type:"number",default:1,title:"Grid Size"}),SnakeHead.attributes.add("moveRate",{type:"number",default:.2,title:"Move Rate (sec)"}),SnakeHead.attributes.add("fieldWidth",{type:"number",default:20,title:"Field Width"}),SnakeHead.attributes.add("fieldHeight",{type:"number",default:20,title:"Field Height"}),SnakeHead.attributes.add("foodEntity",{type:"entity",title:"Food Entity"}),SnakeHead.attributes.add("snakeBodyContainer",{type:"entity",title:"Snake Body Container"}),SnakeHead.attributes.add("snakeBodyTemplate",{type:"entity",title:"Snake Body Container"}),SnakeHead.prototype.initialize=function(){this.direction=new pc.Vec3(1,0,0),this.inputQueue=[],this.timer=0,this.isGameOver=!1,this.bodyParts=[],this.positions=[],null!=this.app.keyboard&&this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.startTouch=null,null!=this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this)),this.restartGame(),this.spawnFood(),Logger.instance.startLog()},SnakeHead.prototype.onKeyDown=function(t){if(this.isGameOver)return;let e=null;switch(t.key){case pc.KEY_LEFT:case pc.KEY_A:e=new pc.Vec3(-1,0,0);break;case pc.KEY_RIGHT:case pc.KEY_D:e=new pc.Vec3(1,0,0);break;case pc.KEY_UP:case pc.KEY_W:e=new pc.Vec3(0,1,0);break;case pc.KEY_DOWN:case pc.KEY_S:e=new pc.Vec3(0,-1,0)}!e||e.x===-this.direction.x&&e.y===-this.direction.y||this.inputQueue.push(e)},SnakeHead.prototype.onTouchStart=function(t){this.isGameOver||(this.startTouch=t.touches[0])},SnakeHead.prototype.onTouchEnd=function(t){if(this.isGameOver||!this.startTouch)return;let e=t.changedTouches[0],i=e.x-this.startTouch.x,s=e.y-this.startTouch.y,o=Math.abs(i),a=Math.abs(s);(o>20||a>20)&&(o>a?i>0&&-1!==this.direction.x?this.direction.set(1,0,0):i<0&&1!==this.direction.x&&this.direction.set(-1,0,0):s>0&&-1!==this.direction.y?this.direction.set(0,-1,0):s<0&&1!==this.direction.y&&this.direction.set(0,1,0)),this.startTouch=null},SnakeHead.prototype.update=function(t){if(!this.isGameOver&&(this.timer+=t,this.timer>=this.moveRate)){this.timer=0,this.inputQueue.length>0&&(this.direction=this.inputQueue.shift());let t=this.entity.getPosition().clone();this.positions.unshift(t),this.positions.length>this.bodyParts.length+1&&this.positions.pop();let e=this.direction.clone().scale(this.gridSize),i=t.clone().add(e);if(i.x<-this.fieldWidth/2||i.x>=this.fieldWidth/2||i.y<-this.fieldHeight/2||i.y>=this.fieldHeight/2)return void this.gameOver();this.entity.setPosition(i);for(let t=0;t<this.bodyParts.length;t++){let e=this.positions[t];e&&this.bodyParts[t].setPosition(e.x,e.y,0)}for(let t=0;t<this.bodyParts.length;t++)if(i.equals(this.bodyParts[t].getPosition()))return void this.gameOver();i.equals(this.foodEntity.getPosition())&&(this.grow(),this.spawnFood())}},SnakeHead.prototype.gameOver=function(){this.isGameOver=!0,Logger.instance.gameCompletedStats(),SaveSystem.getInstance().data.points=0},SnakeHead.prototype.restartGame=function(){this.isGameOver=!1,this.entity.setPosition(0,0,0),this.direction.set(1,0,0);for(let t=0;t<this.bodyParts.length;t++)this.bodyParts[t].destroy();this.bodyParts=[],this.positions=[],this.spawnFood()},SnakeHead.prototype.grow=function(){this.moveRate>.1&&(this.moveRate-=.01),SaveSystem.getInstance().data.points++,Logger.instance.eatFoodShow();let t,e=this.snakeBodyTemplate.clone();e.enabled=!0,this.snakeBodyContainer.addChild(e),t=this.bodyParts.length>0?this.bodyParts[this.bodyParts.length-1].getPosition().clone():this.entity.getPosition().clone(),e.setPosition(t.x,t.y,0),this.bodyParts.push(e)},SnakeHead.prototype.spawnFood=function(){let t,e,i;do{t=Math.floor(Math.random()*this.fieldWidth)-Math.floor(this.fieldWidth/2),e=Math.floor(Math.random()*this.fieldHeight)-Math.floor(this.fieldHeight/2),i=!0,this.entity.getPosition().x===t&&this.entity.getPosition().y===e&&(i=!1);for(let s=0;s<this.bodyParts.length;s++){let o=this.bodyParts[s].getPosition();if(o.x===t&&o.y===e){i=!1;break}}}while(!i);this.foodEntity.setPosition(t,e,0)};var ScaleCameraOrthoSize=pc.createScript("scaleCameraOrthoSize");ScaleCameraOrthoSize.attributes.add("camera",{type:"entity"}),ScaleCameraOrthoSize.attributes.add("refResolution",{type:"vec2",default:[1960,1200],title:"Reference Resolution",description:"Базовое разрешение экрана"}),ScaleCameraOrthoSize.attributes.add("refOrthoSize",{type:"number",default:5,title:"Reference Ortho Size",description:"Ортографический размер для базового разрешения"}),ScaleCameraOrthoSize.prototype.initialize=function(){this.prevWidth=this.app.graphicsDevice.width,this.prevHeight=this.app.graphicsDevice.height,this.updateOrthoSize()},ScaleCameraOrthoSize.prototype.update=function(){var e=this.app.graphicsDevice.width,t=this.app.graphicsDevice.height;e===this.prevWidth&&t===this.prevHeight||(this.prevWidth=e,this.prevHeight=t,this.updateOrthoSize())},ScaleCameraOrthoSize.prototype.updateOrthoSize=function(){var e=this.refResolution.x/this.refResolution.y,t=this.app.graphicsDevice.width/this.app.graphicsDevice.height;this.camera.camera.orthoHeight=t>e?this.refOrthoSize:this.refOrthoSize*(e/t)};var Food=pc.createScript("food");Food.attributes.add("snakeHead",{type:"entity"}),Food.prototype.initialize=function(){this.gridSize=1,this.fieldWidth=25,this.fieldHeight=25,this.respawn()},Food.prototype.respawn=function(){let t,i,e;do{t=Math.floor(Math.random()*this.fieldWidth)-Math.floor(this.fieldWidth/2),i=Math.floor(Math.random()*this.fieldHeight)-Math.floor(this.fieldHeight/2),e=!0;let o=this.snakeHead.getPosition();if(Math.round(o.x)!==t||Math.round(o.y)!==i){if(null!=this.snakeHead.script.snakeHead.bodyParts){let o=this.snakeHead.script.snakeHead.bodyParts;for(let a=0;a<o.length;a++){let d=o[a].getPosition();if(Math.round(d.x)===t&&Math.round(d.y)===i){e=!1;break}}}}else e=!1}while(!e);this.entity.setPosition(t,i,0)};var GameManager=pc.createScript("gameManager");GameManager.prototype.update=function(a){let e=this.app.root.findByName("SnakeHead"),t=this.app.root.findByName("Food");e.getPosition().equals(t.getPosition())&&(e.script.snakeHead.grow(),t.script.food.respawn())};var Logger=pc.createScript("logger");Logger.instance=null,Logger.getInstance=function(){if(!Logger.instance){console.warn("Logger instance not found. Creating new one.");var t=new pc.Entity("Logger");t.addComponent("script"),t.script.create("logger"),pc.app.root.addChild(t)}return Logger.instance},Logger.prototype.initialize=function(){if(Logger.instance)return console.warn("Logger already exists"),void this.entity.destroy();Logger.instance=this,this.entity.reparent(null),this.exitLogs={type:"Exit",points:0,time:0},this.gameCompleted={type:"GameCompleted",points:0,time:0},this.eatFood={type:"Food",points:0,time:0},this.start={type:"Start",date:null},window.addEventListener("beforeunload",this.exitGame.bind(this))},Logger.prototype.startLog=function(){this.start.date=new Date,this.showLogs(this.start)},Logger.prototype.exitGame=function(){this.exitLogs.points=SaveSystem.instance.data.points,this.exitLogs.time=this.timer.toFixed(2),this.showLogs(this.exitLogs)},Logger.prototype.eatFoodShow=function(){this.eatFood.points=SaveSystem.instance.data.points,this.eatFood.time=this.timer.toFixed(2),this.showLogs(this.eatFood)},Logger.prototype.gameCompletedStats=function(){this.gameCompleted.points=SaveSystem.instance.data.points,this.gameCompleted.time=this.timer.toFixed(2),this.showLogs(this.gameCompleted)},Logger.prototype.showLogs=function(t){console.log(JSON.parse(JSON.stringify(t)))},Logger.prototype.update=function(t){this.timer||(this.timer=0),this.timer+=t};var SaveSystem=pc.createScript("saveSystem");SaveSystem.instance=null,SaveSystem.prototype.data={points:0},SaveSystem.prototype.storageKey="myGameSave3311333",SaveSystem.getInstance=function(){if(!SaveSystem.instance){console.warn("SaveSystem instance not found. Creating new one.");var e=new pc.Entity("SaveSystem");e.addComponent("script"),e.script.create("saveSystem"),pc.app.root.addChild(e)}return SaveSystem.instance},SaveSystem.prototype.initialize=function(){if(SaveSystem.instance)return console.warn("SaveSystem already exists"),void this.entity.destroy();SaveSystem.instance=this,this.entity.reparent(null),window.addEventListener("beforeunload",this.save.bind(this))},SaveSystem.prototype.update=function(e){this.saveTimer||(this.saveTimer=0),this.saveTimer+=e,this.saveTimer>=5&&(this.save(),this.saveTimer=0)},SaveSystem.prototype.save=function(){try{var e=JSON.stringify(this.data);localStorage.setItem(this.storageKey,e)}catch(e){console.error("Failed to save:",e)}},SaveSystem.prototype.load=function(){try{var e=localStorage.getItem(this.storageKey);e&&(this.data=JSON.parse(e),console.log("[SaveSystem] Loaded:",this.data))}catch(e){console.error("Failed to load:",e)}};pc.script.createLoadingScreen((function(e){var t=["body, html {","    margin: 0;","    padding: 0;","    height: 100%;","    width: 100%;","    background-color: #0D0D0D;","}"].join("\n"),n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),document.head.appendChild(n),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e&&e.parentElement&&e.parentElement.removeChild(e)}))}));